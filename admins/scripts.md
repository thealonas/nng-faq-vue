# ⚙️ Скрипты

Для автоматизации большинства процессов, которые требуют много времени, нам нередко приходится писать различные скрипты. Большинство из них и их описание Вы сможете найти здесь.

::: warning Внимание
Перед использованием просьба ознакомиться с [условиями использования](copy/).
:::

::: danger nng 2.0
Документация для скриптов второй версии будет чуть позже, поэтому запустить новые релизы самому пока не выйдет.
:::

## nng

Ядро, используемое во всех скриптах nng на C#.

* GitHub: [https://github.com/MrAlonas/nng](https://github.com/MrAlonas/nng)
* NuGet: [https://www.nuget.org/packages/nng](https://www.nuget.org/packages/nng)

### data.json

Во всех скриптах nng используется единый файл, в котором содержится информация как о группах, так и о заблокированных пользователях:

```json:no-line-numbers
{
  "$schema": "https://raw.githubusercontent.com/MrAlonas/nng/master/schema.json",
  "lst": [
    10000,
    20000
  ],
  "bnnd": [
    {
      "id": 1,
      "name": "Павел Дуров",
      "priority": 4,
      "bot": false,
      "warned": 1,
      "compliant": [
        23000
      ],
      "deleted": false
    },
    {
      "id": 2,
      "name": "Александра Владимирова",
      "priority": 1,
      "bot": true,
      "warned": 0,
      "deleted": true
    }
  ],
  "thx": [
    {
      "id": 3,
      "name": "Вячеслав"
    }
  ]
}
```

## nng bot

Чат-бот для групп nng, позволяющий пользователям подавать заявку на редактора и запрашивать разблокировку. Помимо этого, также предусмотрена админ-панель с возможностью просмотра статистики групп и анализом запросов на разблокировку.

* GitHub: [https://github.com/MrAlonas/nng-bot](https://github.com/MrAlonas/nng-bot)

![](https://raw.githubusercontent.com/MrAlonas/nng-bot/master/.github/bot.png)

### Установка

Воспользуйтесь готовым [Docker-контейнером](https://github.com/orgs/MrAlonas/packages/container/package/nng-bot).

По умолчанию используется порт `1220`, поэтому необходимо использовать прокси-сервер (например nginx).

### Настройка

#### Скрипта

Вся настройка происходит через переменные среды. Ниже приведены все их значения (жирным выделены значения по умолчанию).

* `DataURL` — Ссылка на [общий список](#data-json)
* `EditorGrantEnabled` **(true)** — Включена ли выдача редакторов
* `LogUser` — Айди страницы человека, которому будут отправляться логи  
* `UserToken` — Токен страницы, от которой выполняются действия
* `DialogGroupId` — Айди группы
* `DialogGroupToken` — Токен группы
* `DialogGroupSecret` — Секретный ключ
* `DialogGroupConfirm` — Строка, которую должен вернуть сервер
* `UpdateAtStart` **(true)** — Обновлять ли кэш при запуске
* `UpdatePerHours` **(4)** — Интервал обновления кэша в часах
* `AdminUsers` — Айди администраторов
* `EditorRestriction` **(20)** — Максимальное количество редакторов на человека
* `GroupManagersCeiling` **(100)** — Максимальное количество редакторов в группах

#### Страницы

Нам необходимо получить токен страницы с разрешениями: `status`, `offline`, `groups`, который далее будет использован в переменной `UserToken`.

Проще всего это сделать, перейдя по [ссылке](https://oauth.vk.com/authorize?client_id=7436182&scope=328704&redirect_uri=https://oauth.vk.com/blank.html&display=page&response_type=token&revoke=1).

#### Группы

##### Получение токена

Нам необходимо получить токен группы с разрешением `messages`, который далее будет использован в переменной `DialogGroupToken`.

Проще всего это сделать, перейдя по [ссылке](https://oauth.vk.com/authorize?client_id=7436182&scope=4096&redirect_uri=https://oauth.vk.com/blank.html&display=page&response_type=token&group_ids=) (на конце ссылки подставьте айди своей группы).

##### Callback API

Создайте новый Callback API сервер. Затем сгенерируйте надёжный секретный ключ и вставьте его в `DialogGroupSecret`. Строку, которую должен вернуть сервер, вставьте в `DialogGroupConfirm`. В типах событий выберите только `Входящее сообщение`.

## nng one

Клиентский скрипт, позволяющий автоматизировать массовые действия для групп nng.

* GitHub: [https://github.com/MrAlonas/nng-one](https://github.com/MrAlonas/nng-one)

![](https://raw.githubusercontent.com/MrAlonas/nng-one/master/.github/IMAGES/one.png)

### Возможности

1. Выполнение массовых действий
    1. Блокировка пользователей
    2. Разблокировка пользователя или пользователей
    3. Выдача редактора пользователю или пользователям
    4. Снятие редактора пользователю или пользователям
    5. Удаление всех записей со стены в сообществе или сообществах
    6. Репост записи в сообщества
    7. Создание историй в сообществах
    8. Снятие заблокированных страниц из редакторов
    9. Автоматическое создание новой группы
    10. Снятие редактора у неактивных страниц
2. Возможность поиска
    1. Определённого редактора в сообществе или сообществах
    2. Несостыковок в чёрном списке сообщества и общем списке
3. Вывод статистики по сообществам (с учётом и без учёта заблокированных страниц)
    1. Всего групп
    2. Всего слотов под редакторов
    3. Общее количество подписчиков
    4. Общее количество редакторов
    5. Общее количество подписчиков и редакторов без учёта заблокированных и дубликатов
    6. Максимальное количество руководителей
4. Выполнение действий без капчи
    1. Посредством задержек
    2. Через ruCaptcha
5. Отключение [Callback API Бот](https://vk.com/cbbot) при массовых действиях

### Установка

Скачайте [последний релиз](https://github.com/MrAlonas/nng-one/releases/latest).

### Настройка

#### config.json

```json:no-line-numbers
{
  "Token": "Токен страницы, от которой выполняются действия",
  "RuCaptchaToken": "Токен ruCaptcha",
  "BanReason": "Комментарий при блокировке пользователя",
  "BnndUrl": "Ссылка на список заблокированных из API",
  "GroupsUrl": "Ссылка на список групп из API",
  "CaptchaBypass": false, // Обход капчи при массовых действиях БЕЗ использования ruCaptacha
  "SwitchCallback": true, // Отключение Callback API Бот при массовых действиях
  "Sentry": true // Согласие на отправку отчётов об ошибках
}
```

## nng watchdog

Скрипт, отслеживающий нарушения правил редакторами. В случае нарушения правил радактор автоматически блокируется, а совершенные им нарушения отменяются.

* GitHub: [https://github.com/MrAlonas/nng-watchdog](https://github.com/MrAlonas/nng-watchdog)

### Установка

Воспользуйтесь готовым [Docker-контейнером](https://github.com/orgs/MrAlonas/packages/container/package/nng-watchdog).

По умолчанию используется порт `1221`, поэтому необходимо использовать прокси-сервер (например nginx).

### Настройка

#### Скрипта

Вся настройка происходит через переменные среды. Здесь приведены все их значения:

* `LogUser` — Айди страницы человека, которому будут отправляться логи
* `DialogGroupToken` — Токен группы, от которой будут отправляться логи
* `UserToken` — Токен страницы, от которой будут выполняться действия
* `BanComment` — Комментарий при блокировке редактора

##### groups.json

Для использования watchdog необходимо чтобы во всех группах был включён Callback API. О его настройке можно прочитать [ниже](#callback-api-1). В данном файле для каждой группы хранится строка, которую должен вернуть сервер и секретный ключ от сервера.

```json:no-line-numbers
{
  "Айди группы": {
    "Confirm": "Строка, которую должен вернуть сервер",
    "Secret": "Секретный ключ"
  }
}
```

#### Страницы

Нам необходимо получить токен страницы с разрешениями: `photos`, `wall`, `offline`, `groups`, который далее будет использован в переменной `UserToken`.

Проще всего это сделать, перейдя по [ссылке](https://oauth.vk.com/authorize?client_id=7436182&scope=335876&redirect_uri=https://oauth.vk.com/blank.html&display=page&response_type=token&revoke=1).

#### Группы

##### Получение логов

Для группы, от имени которой будут приходить логи, нам необходимо получить токен группы с разрешением `messages`, который далее будет использован в переменной `DialogGroupToken`.

Проще всего это сделать, перейдя по [ссылке](https://oauth.vk.com/authorize?client_id=7436182&scope=4096&redirect_uri=https://oauth.vk.com/blank.html&display=page&response_type=token&group_ids=) (на конце ссылки подставьте айди своей группы).

##### Callback API

Создайте новый Callback API сервер. Затем сгенерируйте надёжный секретный ключ и вставьте его в `Secret`. Строку, которую должен вернуть сервер, вставьте в `Confirm`.

В типах событий выберите:
* Фотографии: `Добавление`
* Записи на стене: `Добавление`, `Поделились`
* Пользователи: `Выход из сообщества`, `Блокировка`, `Разблокировка`
* Прочее: `Изменение основной фотографии`

## nng server

Скрипт, автоматизирующий выдачу редакторов в группах, достигших 50 или 100 участников. Помимо этого, скрипт автоматически убирает заблокированные страницы из редакторов, очищает статусы и актуализирует чёрный список.

* GitHub: [https://github.com/MrAlonas/nng-server](https://github.com/MrAlonas/nng-server)

### Установка

Воспользуйтесь готовым [Docker-контейнером](https://github.com/orgs/MrAlonas/packages/container/package/nng-server).

### Настройка

#### Скрипта

Вся настройка происходит через переменные среды. Ниже приведены все их значения (жирным выделены значения по умолчанию).

* `DataURL` — Ссылка на [общий список](#data-json)
* `UserToken` — Токен страницы, от которой выполняются действия
* `UpdateTimeInMinutes` **(10)** —  Интервал проверки последней группы
* `BanComment` — Комментарий при блокировке пользователя

#### Страницы

Нам необходимо получить токен страницы с разрешениями: `status`, `wall`, `offline`, `groups`. Который далее будет использован в переменной `UserToken`.

Проще всего это сделать, перейдя по [ссылке](https://oauth.vk.com/authorize?client_id=7436182&scope=336896&redirect_uri=https://oauth.vk.com/blank.html&display=page&response_type=token&revoke=1).
